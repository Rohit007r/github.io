<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HNIT Help Bot</title>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <style>
    body { font-family: Arial; background: #121212; color: #fff; padding: 20px; }
    #chatbox { max-width:600px; margin:auto; background:#1e1e1e; border-radius:10px; padding:20px; overflow-y:auto; max-height:80vh; }
    .bot, .user { padding:10px; border-radius:10px; margin:10px 0; }
    .bot { background:#2c2c2c; text-align:left; }
    .user { background:#444; text-align:right; }
    input { width:70%; padding:10px; border-radius:10px; border:none; outline:none; }
    button { padding:10px 15px; background:#ff4081; color:#fff; border:none; border-radius:10px; margin-left:5px; cursor:pointer; }
    .suggestions button { background:#444; color:#fff; margin:5px 5px 0 0; border:none; border-radius:8px; padding:6px 10px; cursor:pointer; }
  </style>
</head>
<body>
  <div id="chatbox"><div class="bot">Hi! Please type your issue üëá</div></div>
  <div style="text-align:center; margin-top:10px;">
    <input type="text" id="userInput" placeholder="Type your query..." />
    <button onclick="handleUserInput()">Send</button>
  </div>
  <script>
    let data = [];

    async function loadCSV() {
      const url = 'https://raw.githubusercontent.com/Rohit007r/github.io/main/data.csv';
      console.log('üîÅ Fetching CSV:', url);
      try {
        const res = await fetch(url);
        console.log('‚úÖ Fetch status:', res.status);
        const text = await res.text();
        console.log('üìÑ CSV snippet:', text.slice(0,200));

        const parsed = Papa.parse(text, { header:true, skipEmptyLines:true });
        console.log('üìä Parsed:', parsed);

        data = parsed.data.map(e => ({
          query: (e.query||'').toLowerCase().trim(),
          answer: (e.answer||'').trim()
        }));
        console.log('‚úÖ Loaded entries:', data.length);
      } catch (err) {
        console.error('‚ùå CSV load error:', err);
      }
    }

    function addMessage(text, sender='bot') {
      const chatbox = document.getElementById('chatbox');
      const div = document.createElement('div');
      div.className = sender;
      div.textContent = text;
      chatbox.appendChild(div);
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    function showSuggestions(matches) {
      const chatbox = document.getElementById('chatbox');
      const div = document.createElement('div');
      div.className = 'bot suggestions';
      div.innerHTML = '<strong>Did you mean:</strong><br>' +
        matches.map(m => `<button onclick="selectSuggestion('${m.query.replace(/'/g,"\\'")}')">${m.query}</button>`).join('');
      chatbox.appendChild(div);
    }

    function selectSuggestion(q) {
      addMessage(q, 'user');
      const found = data.find(d => d.query===q);
      addMessage(found?.answer || "Sorry, no answer found.", 'bot');
    }

    function handleUserInput() {
      const inp = document.getElementById('userInput');
      const t = inp.value.trim().toLowerCase();
      if (!t) return;
      addMessage(t, 'user');
      inp.value = '';
      const exact = data.find(d => d.query===t);
      if (exact) {
        addMessage(exact.answer, 'bot');
      } else {
        const suggestions = data.filter(d => d.query.includes(t)).slice(0,5);
        if (suggestions.length) showSuggestions(suggestions);
        else addMessage("Sorry, I couldn't find an answer for that.", 'bot');
      }
    }

    loadCSV();
  </script>
</body>
</html>